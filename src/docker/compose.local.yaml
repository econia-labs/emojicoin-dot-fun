# yamllint disable rule:empty-lines rule:key-ordering rule:brackets

# Services in this file are EXCLUSIVELY for running a local testnet.
---
include:
  # This setup allows us to only have to specify only one compose file.
  - path:
    - 'compose.yaml'
    - 'processor-override.yaml'
services:
  localnet-node:
    network_mode: 'host'
    image: 'econialabs/aptos-cli:4.1.0'
    ports:
    - '50051:50051'
    - '8070:8070'
    - '8090:8090'
    - '8080:8080'
    - '8081:8081'
    healthcheck:
      test: [ 'CMD', 'sh/healthcheck.sh' ]
      interval: '5s'
      timeout: '5s'
      retries: 10
      start_period: '60s'
    volumes:
    - '/var/run/docker.sock:/var/run/docker.sock'
    entrypoint: [
      'aptos',
      'node',
      'run-localnet',
      '--with-indexer-api',
      '--force-restart',
      '--bind-to',
      '0.0.0.0'
    ]
  localnet-deployer:
    extra_hosts:
    - 'host.docker.internal:host-gateway'
    build:
      context: '../../'
      dockerfile: 'src/docker/localnet-deployer/Dockerfile'
      args:
        PUBLISHER_PRIVATE_KEY: '${PUBLISHER_PRIVATE_KEY}'
    environment:
      PUBLISHER_PRIVATE_KEY: '${PUBLISHER_PRIVATE_KEY}'
    image: 'xbtmatt/emojicoin-dot-fun-aptos-node:latest'
    depends_on:
      localnet-node:
        condition: 'service_healthy'
...
